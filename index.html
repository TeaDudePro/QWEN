<!DOCTYPE html>
<html>
<head>
    <title>USDT Payment</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://unpkg.com/@walletconnect/web3-provider@latest/dist/umd/index.min.js"></script>
</head>
<body>
    <button onclick="connectWallet()">Pay 100 USDT</button>

    <script>
        let web3;
        let userAddress;

        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    // Запрос подключения кошелька
                    const accounts = await window.ethereum.request({
                        method: 'eth_requestAccounts'
                    });
                    
                    userAddress = accounts[0];
                    web3 = new Web3(window.ethereum);
                    
                    // После подключения показываем интерфейс выбора сети и суммы
                    showTransactionInterface();
                    
                } catch (error) {
                    console.error('Connection failed:', error);
                }
            } else {
                alert('Please install MetaMask or other Web3 wallet!');
            }
        }

        function showTransactionInterface() {
            // Создаем интерфейс для выбора сети и подтверждения транзакции
            const interfaceHTML = `
                <div id="paymentInterface" style="border: 1px solid #ccc; padding: 20px; margin: 10px;">
                    <h3>Pay 100 USDT</h3>
                    <label>Select Network:</label>
                    <select id="networkSelect">
                        <option value="0xdAC17F958D2ee523a2206206994597C13D831ec7">Ethereum (ERC-20)</option>
                        <option value="0xc2132D05D31c914a87C6611C10748AEb04B58e8F">Polygon</option>
                        <option value="0x55d398326f99059fF775485246999027B3197955">BNB Chain</option>
                        <option value="0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9">Arbitrum</option>
                    </select>
                    <br><br>
                    <label>Amount: </label>
                    <input type="number" id="amountInput" value="100" step="0.1">
                    <span>USDT</span>
                    <br><br>
                    <button onclick="sendUSDT()">Confirm Payment</button>
                </div>
            `;
            
            document.body.innerHTML += interfaceHTML;
        }

        async function sendUSDT() {
            const contractAddress = document.getElementById('networkSelect').value;
            const amount = document.getElementById('amountInput').value;
            
            // ABI для функции transfer USDT
            const minABI = [
                {
                    "constant": false,
                    "inputs": [
                        {"name": "_to", "type": "address"},
                        {"name": "_value", "type": "uint256"}
                    ],
                    "name": "transfer",
                    "outputs": [{"name": "", "type": "bool"}],
                    "type": "function"
                }
            ];

            const contract = new web3.eth.Contract(minABI, contractAddress);
            const amountWei = web3.utils.toWei(amount.toString(), 'mwei'); // USDT имеет 6 decimals

            try {
                const transaction = await contract.methods.transfer(
                    '0x5aAeb6053F3E94C9b9A09f33669435E7Ef1BeAed', // recipient
                    amountWei
                ).send({
                    from: userAddress,
                    gas: 100000
                });

                alert('Transaction successful: ' + transaction.transactionHash);
            } catch (error) {
                console.error('Transaction failed:', error);
                alert('Transaction failed: ' + error.message);
            }
        }
    </script>
</body>
</html>